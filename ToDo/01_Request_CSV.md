[MS-PL License]://opensource.org/licenses/ms-pl.html

## :cyclone: План разработки надстройки

### Чтение файла CSV по стандарту [RFC 4180]

* [ ] Предотвратить удаление первых нулей
* [ ] Предотвратить преобразование чисел >1 с точкой/слешем/тире в даты (добавить в начало пробел/нуль-пробел/равно)
* [ ] Предотвратить преобразование чисел с плавающей точкой больше 16 знаков
* [ ] Предотвратить преобразование чисел с символом `E` между цифр
* [ ] Перед открытием CSV удалять пробелы перед *символом разделителя*
* [ ] При наличии *символа разделителя* экранировать значения двойными кавычками

[RFC 4180]://tools.ietf.org/html/rfc4180

### Сохранение файла CSV

* [ ] Перед редактированием CSV создавать резервную копию
* [ ] Перед открытием CSV изменять формат колонок
* [ ] Выявлять строку заголовка и применять к ней автофильтр
* [ ] Добавить в начале CSV строку `sep=;` на основании региональных настроек EU
* [ ] Изменять в CSV разделитель дробной части на основании региональных настроек EU
* [ ] Перед сохранением CSV изменять формат дат на `YYYY-MM-DD`
* [ ] Перед открытием CSV проверять наличие небезопасных данных `"=`
* [ ] Экранировать значение двойными кавычками если первым идёт специальный символ `=`

### Прочие настройки и функции Excel

* [ ] Заменить в шаблоне `xls?\xl\styles.xml` атрибут `numFmtId="0"` на `numFmtId="49"` (текстовый формат для книги)
* [ ] Интервально читать данные из столбца и записывать в новую таблицу (учитывать количество колонок)

## :cyclone: Преобразование CSV в Excel

Формат CSV используется уже более 30 лет, но несмотря на его длительную историю, он никогда не был официально задокументирован. Название CSV (*Comma-Separated Values*) возникло из-за использования запятых для разделения полей данных.
Но это в теории. На самом деле, множество так называемых CSV-файлов используют другие символы для разделения данных, например:

* Табуляция - TSV-файлы (*tab-separated values*)
* Точка с запятой - SCSV-файлы (*semicolon separated values*)

Некоторые вариации файлов CSV разделяют поля данных одинарными или двойными кавычками, другие требуют маркер последовательности байтов из Юникода (BOM), например, UTF-8, для корректной интерпретации Юникода.
Это отсутствие стандартов порождает разнообразные проблемы, с которыми Вы можете столкнуться, пытаясь преобразовать файл Excel в CSV, и особенно, когда импортируете файл CSV в Excel.

Если Ваш файл CSV содержит численные данные или даты, Excel может преобразовать их с ошибками.

## :cyclone: Ссылки

1. [Язвы и грабли CSV и Excel](//habr.com/post/129476/ "RU, 2011-09-30")
2. [Excel искажает 20% данных](//habr.com/post/396941/ "RU, 2016-08-24")

# 
